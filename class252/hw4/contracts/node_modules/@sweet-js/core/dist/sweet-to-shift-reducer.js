'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _sweetSpec = require('sweet-spec');

var S = _interopRequireWildcard(_sweetSpec);

var _ramda = require('ramda');

var _immutable = require('immutable');

var _terms = require('./terms');

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

const notEmptyStatement = (0, _ramda.complement)(_terms.isEmptyStatement);

// $FlowFixMe: flow doesn't know about CloneReducer yet
exports.default = class extends S.default.CloneReducer {

  constructor(phase) {
    super();
    this.phase = phase;
  }

  reduceModule(t, s) {
    return new S.Module({
      directives: s.directives.filter(d => !d.startsWith('lang')).map(d => ({ type: 'Directive', rawValue: d })).toArray(),
      items: s.items.toArray().filter(notEmptyStatement)
    });
  }

  reduceIdentifierExpression(t, s) {
    return new S.IdentifierExpression({
      name: s.name.resolve(this.phase)
    });
  }

  reduceStaticPropertyName(t, s) {
    return new S.StaticPropertyName({
      value: s.value.val().toString()
    });
  }

  reduceBindingIdentifier(t, s) {
    return new S.BindingIdentifier({
      name: s.name.resolve(this.phase)
    });
  }

  reduceStaticMemberExpression(t, s) {
    return new S.StaticMemberExpression({
      object: s.object,
      property: s.property.val()
    });
  }

  reduceFunctionBody(t, s) {
    return new S.FunctionBody({
      directives: s.directives.toArray(),
      statements: s.statements.toArray().filter(notEmptyStatement)
    });
  }

  reduceVariableDeclarationStatement(t, s) {
    if (t.declaration.kind === 'syntax' || t.declaration.kind === 'syntaxrec' || t.declaration.kind === 'operator') {
      return new S.EmptyStatement();
    }
    return new S.VariableDeclarationStatement({
      declaration: s.declaration
    });
  }

  reduceVariableDeclaration(t, s) {
    return new S.VariableDeclaration({
      kind: s.kind,
      declarators: s.declarators.toArray()
    });
  }

  reduceCallExpression(t, s) {
    return new S.CallExpression({
      callee: s.callee,
      arguments: s.arguments.toArray()
    });
  }

  reduceArrayExpression(t, s) {
    return new S.ArrayExpression({
      elements: s.elements.toArray()
    });
  }

  reduceImportNamespace(t, s) {
    if (s.forSyntax) {
      return new S.EmptyStatement();
    }
    return t;
  }

  reduceImport(t, s) {
    if (s.forSyntax) {
      return new S.EmptyStatement();
    }
    return new S.Import({
      forSyntax: false,
      defaultBinding: s.defaultBinding,
      moduleSpecifier: s.moduleSpecifier.val(),
      namedImports: s.namedImports.toArray()
    });
  }

  reduceBlock(t, s) {
    return new S.Block({
      statements: s.statements.toArray().filter(notEmptyStatement)
    });
  }

  reduceExportSpecifier(t, s) {
    return new S.ExportSpecifier({
      name: s.name != null ? s.name.resolve(0) : null,
      exportedName: s.exportedName.val()
    });
  }

  reduceExportFrom(t, s) {
    return new S.ExportFrom({
      moduleSpecifier: s.moduleSpecifier != null ? s.moduleSpecifier.val() : null,
      namedExports: s.namedExports.toArray()
    });
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zd2VldC10by1zaGlmdC1yZWR1Y2VyLmpzIl0sIm5hbWVzIjpbIlMiLCJub3RFbXB0eVN0YXRlbWVudCIsIkNsb25lUmVkdWNlciIsImNvbnN0cnVjdG9yIiwicGhhc2UiLCJyZWR1Y2VNb2R1bGUiLCJ0IiwicyIsIk1vZHVsZSIsImRpcmVjdGl2ZXMiLCJmaWx0ZXIiLCJkIiwic3RhcnRzV2l0aCIsIm1hcCIsInR5cGUiLCJyYXdWYWx1ZSIsInRvQXJyYXkiLCJpdGVtcyIsInJlZHVjZUlkZW50aWZpZXJFeHByZXNzaW9uIiwiSWRlbnRpZmllckV4cHJlc3Npb24iLCJuYW1lIiwicmVzb2x2ZSIsInJlZHVjZVN0YXRpY1Byb3BlcnR5TmFtZSIsIlN0YXRpY1Byb3BlcnR5TmFtZSIsInZhbHVlIiwidmFsIiwidG9TdHJpbmciLCJyZWR1Y2VCaW5kaW5nSWRlbnRpZmllciIsIkJpbmRpbmdJZGVudGlmaWVyIiwicmVkdWNlU3RhdGljTWVtYmVyRXhwcmVzc2lvbiIsIlN0YXRpY01lbWJlckV4cHJlc3Npb24iLCJvYmplY3QiLCJwcm9wZXJ0eSIsInJlZHVjZUZ1bmN0aW9uQm9keSIsIkZ1bmN0aW9uQm9keSIsInN0YXRlbWVudHMiLCJyZWR1Y2VWYXJpYWJsZURlY2xhcmF0aW9uU3RhdGVtZW50IiwiZGVjbGFyYXRpb24iLCJraW5kIiwiRW1wdHlTdGF0ZW1lbnQiLCJWYXJpYWJsZURlY2xhcmF0aW9uU3RhdGVtZW50IiwicmVkdWNlVmFyaWFibGVEZWNsYXJhdGlvbiIsIlZhcmlhYmxlRGVjbGFyYXRpb24iLCJkZWNsYXJhdG9ycyIsInJlZHVjZUNhbGxFeHByZXNzaW9uIiwiQ2FsbEV4cHJlc3Npb24iLCJjYWxsZWUiLCJhcmd1bWVudHMiLCJyZWR1Y2VBcnJheUV4cHJlc3Npb24iLCJBcnJheUV4cHJlc3Npb24iLCJlbGVtZW50cyIsInJlZHVjZUltcG9ydE5hbWVzcGFjZSIsImZvclN5bnRheCIsInJlZHVjZUltcG9ydCIsIkltcG9ydCIsImRlZmF1bHRCaW5kaW5nIiwibW9kdWxlU3BlY2lmaWVyIiwibmFtZWRJbXBvcnRzIiwicmVkdWNlQmxvY2siLCJCbG9jayIsInJlZHVjZUV4cG9ydFNwZWNpZmllciIsIkV4cG9ydFNwZWNpZmllciIsImV4cG9ydGVkTmFtZSIsInJlZHVjZUV4cG9ydEZyb20iLCJFeHBvcnRGcm9tIiwibmFtZWRFeHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFDQTs7SUFBa0JBLEM7O0FBQ2xCOztBQUNBOztBQUVBOzs7O0FBSUEsTUFBTUMsb0JBQW9CLCtDQUExQjs7QUFFQTtrQkFDZSxjQVhHRCxDQVdXLFNBQUtFLFlBQW5CLENBQWdDOztBQUc3Q0MsY0FBWUMsS0FBWixFQUEyQjtBQUN6QjtBQUNBLFNBQUtBLEtBQUwsR0FBYUEsS0FBYjtBQUNEOztBQUVEQyxlQUFhQyxDQUFiLEVBQXNCQyxDQUF0QixFQUF5RTtBQUN2RSxXQUFPLElBQUlQLEVBQUVRLE1BQU4sQ0FBYTtBQUNsQkMsa0JBQVlGLEVBQUVFLFVBQUYsQ0FDVEMsTUFEUyxDQUNGQyxLQUFLLENBQUNBLEVBQUVDLFVBQUYsQ0FBYSxNQUFiLENBREosRUFFVEMsR0FGUyxDQUVMRixNQUFNLEVBQUVHLE1BQU0sV0FBUixFQUFxQkMsVUFBVUosQ0FBL0IsRUFBTixDQUZLLEVBR1RLLE9BSFMsRUFETTtBQUtsQkMsYUFBT1YsRUFBRVUsS0FBRixDQUFRRCxPQUFSLEdBQWtCTixNQUFsQixDQUF5QlQsaUJBQXpCO0FBTFcsS0FBYixDQUFQO0FBT0Q7O0FBRURpQiw2QkFBMkJaLENBQTNCLEVBQW9DQyxDQUFwQyxFQUF5RDtBQUN2RCxXQUFPLElBQUlQLEVBQUVtQixvQkFBTixDQUEyQjtBQUNoQ0MsWUFBTWIsRUFBRWEsSUFBRixDQUFPQyxPQUFQLENBQWUsS0FBS2pCLEtBQXBCO0FBRDBCLEtBQTNCLENBQVA7QUFHRDs7QUFFRGtCLDJCQUF5QmhCLENBQXpCLEVBQWtDQyxDQUFsQyxFQUF3RDtBQUN0RCxXQUFPLElBQUlQLEVBQUV1QixrQkFBTixD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LENBQXJCLEVBQW1EO0FBQ2pELFdBQU8sSUFBSVAsRUFBRTJELEtBQU4sQ0FBWTtBQUNqQnhCLGtCQUFZNUIsRUFBRTRCLFVBQUYsQ0FBYW5CLE9BQWIsR0FBdUJOLE1BQXZCLENBQThCVCxpQkFBOUI7QUFESyxLQUFaLENBQVA7QUFHRDs7QUFFRDJELHdCQUFzQnRELENBQXRCLEVBQStCQyxDQUEvQixFQUF3RTtBQUN0RSxXQUFPLElBQUlQLEVBQUU2RCxlQUFOLENBQXNCO0FBQzNCekMsWUFBTWIsRUFBRWEsSUFBRixJQUFVLElBQVYsR0FBaUJiLEVBQUVhLElBQUYsQ0FBT0MsT0FBUCxDQUFlLENBQWYsQ0FBakIsR0FBcUMsSUFEaEI7QUFFM0J5QyxvQkFBY3ZELEVBQUV1RCxZQUFGLENBQWVyQyxHQUFmO0FBRmEsS0FBdEIsQ0FBUDtBQUlEOztBQUVEc0MsbUJBQ0V6RCxDQURGLEVBRUVDLENBRkYsRUFHRTtBQUNBLFdBQU8sSUFBSVAsRUFBRWdFLFVBQU4sQ0FBaUI7QUFDdEJSLHVCQUNFakQsRUFBRWlELGVBQUYsSUFBcUIsSUFBckIsR0FBNEJqRCxFQUFFaUQsZUFBRixDQUFrQi9CLEdBQWxCLEVBQTVCLEdBQXNELElBRmxDO0FBR3RCd0Msb0JBQWMxRCxFQUFFMEQsWUFBRixDQUFlakQsT0FBZjtBQUhRLEtBQWpCLENBQVA7QUFLRDtBQTdJNEMsQyIsImZpbGUiOiJzd2VldC10by1zaGlmdC1yZWR1Y2VyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQGZsb3dcbmltcG9ydCBUZXJtLCAqIGFzIFMgZnJvbSAnc3dlZXQtc3BlYyc7XG5pbXBvcnQgeyBjb21wbGVtZW50IH0gZnJvbSAncmFtZGEnO1xuaW1wb3J0IHsgTGlzdCB9IGZyb20gJ2ltbXV0YWJsZSc7XG5cbmltcG9ydCB7IGlzRW1wdHlTdGF0ZW1lbnQgfSBmcm9tICcuL3Rlcm1zJztcblxuaW1wb3J0IHR5cGUgU3ludGF4IGZyb20gJy4vc3ludGF4LmpzJztcblxuY29uc3Qgbm90RW1wdHlTdGF0ZW1lbnQgPSBjb21wbGVtZW50KGlzRW1wdHlTdGF0ZW1lbnQpO1xuXG4vLyAkRmxvd0ZpeE1lOiBmbG93IGRvZXNuJ3Qga25vdyBhYm91dCBDbG9uZVJlZHVjZXIgeWV0XG5leHBvcnQgZGVmYXVsdCBjbGFzcyBleHRlbmRzIFRlcm0uQ2xvbmVSZWR1Y2VyIHtcbiAgcGhhc2U6IG51bWJlcjtcblxuICBjb25zdHJ1Y3RvcihwaGFzZTogbnVtYmVyKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLnBoYXNlID0gcGhhc2U7XG4gIH1cblxuICByZWR1Y2VNb2R1bGUodDogVGVybSwgczogeyBkaXJlY3RpdmVzOiBMaXN0PHN0cmluZz4sIGl0ZW1zOiBMaXN0PGFueT4gfSkge1xuICAgIHJldHVybiBuZXcgUy5Nb2R1bGUoe1xuICAgICAgZGlyZWN0aXZlczogcy5kaXJlY3RpdmVzXG4gICAgICAgIC5maWx0ZXIoZCA9PiAhZC5zdGFydHNXaXRoKCdsYW5nJykpXG4gICAgICAgIC5tYXAoZCA9PiAoeyB0eXBlOiAnRGlyZWN0aXZlJywgcmF3VmFsdWU6IGQgfSkpXG4gICAgICAgIC50b0FycmF5KCksXG4gICAgICBpdGVtczogcy5pdGVtcy50b0FycmF5KCkuZmlsdGVyKG5vdEVtcHR5U3RhdGVtZW50KSxcbiAgICB9KTtcbiAgfVxuXG4gIHJlZHVjZUlkZW50aWZpZXJFeHByZXNzaW9uKHQ6IFRlcm0sIHM6IHsgbmFtZTogU3ludGF4IH0pIHtcbiAgICByZXR1cm4gbmV3IFMuSWRlbnRpZmllckV4cHJlc3Npb24oe1xuICAgICAgbmFtZTogcy5uYW1lLnJlc29sdmUodGhpcy5waGFzZSksXG4gICAgfSk7XG4gIH1cblxuICByZWR1Y2VTdGF0aWNQcm9wZXJ0eU5hbWUodDogVGVybSwgczogeyB2YWx1ZTogU3ludGF4IH0pIHtcbiAgICByZXR1cm4gbmV3IFMuU3RhdGljUHJvcGVydHlOYW1lKHtcbiAgICAgIHZhbHVlOiBzLnZhbHVlLnZhbCgpLnRvU3RyaW5nKCksXG4gICAgfSk7XG4gIH1cblxuICByZWR1Y2VCaW5kaW5nSWRlbnRpZmllcih0OiBUZXJtLCBzOiB7IG5hbWU6IFN5bnRheCB9KSB7XG4gICAgcmV0dXJuIG5ldyBTLkJpbmRpbmdJZGVudGlmaWVyKHtcbiAgICAgIG5hbWU6IHMubmFtZS5yZXNvbHZlKHRoaXMucGhhc2UpLFxuICAgIH0pO1xuICB9XG5cbiAgcmVkdWNlU3RhdGljTWVtYmVyRXhwcmVzc2lvbih0OiBUZXJtLCBzOiB7IG9iamVjdDogYW55LCBwcm9wZXJ0eTogU3ludGF4IH0pIHtcbiAgICByZXR1cm4gbmV3IFMuU3RhdGljTWVtYmVyRXhwcmVzc2lvbih7XG4gICAgICBvYmplY3Q6IHMub2JqZWN0LFxuICAgICAgcHJvcGVydHk6IHMucHJvcGVydHkudmFsKCksXG4gICAgfSk7XG4gIH1cblxuICByZWR1Y2VGdW5jdGlvbkJvZHkoXG4gICAgdDogVGVybSxcbiAgICBzOiB7IHN0YXRlbWVudHM6IExpc3Q8YW55PiwgZGlyZWN0aXZlczogTGlzdDxhbnk+IH0sXG4gICkge1xuICAgIHJldHVybiBuZXcgUy5GdW5jdGlvbkJvZHkoe1xuICAgICAgZGlyZWN0aXZlczogcy5kaXJlY3RpdmVzLnRvQXJyYXkoKSxcbiAgICAgIHN0YXRlbWVudHM6IHMuc3RhdGVtZW50cy50b0FycmF5KCkuZmlsdGVyKG5vdEVtcHR5U3RhdGVtZW50KSxcbiAgICB9KTtcbiAgfVxuXG4gIHJlZHVjZVZhcmlhYmxlRGVjbGFyYXRpb25TdGF0ZW1lbnQodDogYW55LCBzOiB7IGRlY2xhcmF0aW9uOiBhbnkgfSkge1xuICAgIGlmIChcbiAgICAgIHQuZGVjbGFyYXRpb24ua2luZCA9PT0gJ3N5bnRheCcgfHxcbiAgICAgIHQuZGVjbGFyYXRpb24ua2luZCA9PT0gJ3N5bnRheHJlYycgfHxcbiAgICAgIHQuZGVjbGFyYXRpb24ua2luZCA9PT0gJ29wZXJhdG9yJ1xuICAgICkge1xuICAgICAgcmV0dXJuIG5ldyBTLkVtcHR5U3RhdGVtZW50KCk7XG4gICAgfVxuICAgIHJldHVybiBuZXcgUy5WYXJpYWJsZURlY2xhcmF0aW9uU3RhdGVtZW50KHtcbiAgICAgIGRlY2xhcmF0aW9uOiBzLmRlY2xhcmF0aW9uLFxuICAgIH0pO1xuICB9XG5cbiAgcmVkdWNlVmFyaWFibGVEZWNsYXJhdGlvbih0OiBUZXJtLCBzOiB7IGtpbmQ6IGFueSwgZGVjbGFyYXRvcnM6IExpc3Q8YW55PiB9KSB7XG4gICAgcmV0dXJuIG5ldyBTLlZhcmlhYmxlRGVjbGFyYXRpb24oe1xuICAgICAga2luZDogcy5raW5kLFxuICAgICAgZGVjbGFyYXRvcnM6IHMuZGVjbGFyYXRvcnMudG9BcnJheSgpLFxuICAgIH0pO1xuICB9XG5cbiAgcmVkdWNlQ2FsbEV4cHJlc3Npb24odDogVGVybSwgczogeyBjYWxsZWU6IGFueSwgYXJndW1lbnRzOiBMaXN0PGFueT4gfSkge1xuICAgIHJldHVybiBuZXcgUy5DYWxsRXhwcmVzc2lvbih7XG4gICAgICBjYWxsZWU6IHMuY2FsbGVlLFxuICAgICAgYXJndW1lbnRzOiBzLmFyZ3VtZW50cy50b0FycmF5KCksXG4gICAgfSk7XG4gIH1cblxuICByZWR1Y2VBcnJheUV4cHJlc3Npb24odDogVGVybSwgczogeyBlbGVtZW50czogTGlzdDxhbnk+IH0pIHtcbiAgICByZXR1cm4gbmV3IFMuQXJyYXlFeHByZXNzaW9uKHtcbiAgICAgIGVsZW1lbnRzOiBzLmVsZW1lbnRzLnRvQXJyYXkoKSxcbiAgICB9KTtcbiAgfVxuXG4gIHJlZHVjZUltcG9ydE5hbWVzcGFjZShcbiAgICB0OiBUZXJtLFxuICAgIHM6IHtcbiAgICAgIGRlZmF1bHRCaW5kaW5nOiBTLkJpbmRpbmdJZGVudGlmaWVyLFxuICAgICAgbW9kdWxlU3BlY2lmaWVyOiBTeW50YXgsXG4gICAgICBuYW1lc3BhY2VCaW5kaW5nOiBTLkJpbmRpbmdJZGVudGlmaWVyLFxuICAgIH0sXG4gICkge1xuICAgIGlmIChzLmZvclN5bnRheCkge1xuICAgICAgcmV0dXJuIG5ldyBTLkVtcHR5U3RhdGVtZW50KCk7XG4gICAgfVxuICAgIHJldHVybiB0O1xuICB9XG5cbiAgcmVkdWNlSW1wb3J0KFxuICAgIHQ6IFRlcm0sXG4gICAgczoge1xuICAgICAgZGVmYXVsdEJpbmRpbmc6IFMuQmluZGluZ0lkZW50aWZpZXIsXG4gICAgICBtb2R1bGVTcGVjaWZpZXI6IFN5bnRheCxcbiAgICAgIG5hbWVkSW1wb3J0czogTGlzdDxhbnk+LFxuICAgIH0sXG4gICkge1xuICAgIGlmIChzLmZvclN5bnRheCkge1xuICAgICAgcmV0dXJuIG5ldyBTLkVtcHR5U3RhdGVtZW50KCk7XG4gICAgfVxuICAgIHJldHVybiBuZXcgUy5JbXBvcnQoe1xuICAgICAgZm9yU3ludGF4OiBmYWxzZSxcbiAgICAgIGRlZmF1bHRCaW5kaW5nOiBzLmRlZmF1bHRCaW5kaW5nLFxuICAgICAgbW9kdWxlU3BlY2lmaWVyOiBzLm1vZHVsZVNwZWNpZmllci52YWwoKSxcbiAgICAgIG5hbWVkSW1wb3J0czogcy5uYW1lZEltcG9ydHMudG9BcnJheSgpLFxuICAgIH0pO1xuICB9XG5cbiAgcmVkdWNlQmxvY2sodDogVGVybSwgczogeyBzdGF0ZW1lbnRzOiBMaXN0PGFueT4gfSkge1xuICAgIHJldHVybiBuZXcgUy5CbG9jayh7XG4gICAgICBzdGF0ZW1lbnRzOiBzLnN0YXRlbWVudHMudG9BcnJheSgpLmZpbHRlcihub3RFbXB0eVN0YXRlbWVudCksXG4gICAgfSk7XG4gIH1cblxuICByZWR1Y2VFeHBvcnRTcGVjaWZpZXIodDogVGVybSwgczogeyBuYW1lPzogYW55LCBleHBvcnRlZE5hbWU6IFN5bnRheCB9KSB7XG4gICAgcmV0dXJuIG5ldyBTLkV4cG9ydFNwZWNpZmllcih7XG4gICAgICBuYW1lOiBzLm5hbWUgIT0gbnVsbCA/IHMubmFtZS5yZXNvbHZlKDApIDogbnVsbCxcbiAgICAgIGV4cG9ydGVkTmFtZTogcy5leHBvcnRlZE5hbWUudmFsKCksXG4gICAgfSk7XG4gIH1cblxuICByZWR1Y2VFeHBvcnRGcm9tKFxuICAgIHQ6IFRlcm0sXG4gICAgczogeyBtb2R1bGVTcGVjaWZpZXI/OiBTeW50YXgsIG5hbWVkRXhwb3J0czogTGlzdDxTLkV4cG9ydFNwZWNpZmllcj4gfSxcbiAgKSB7XG4gICAgcmV0dXJuIG5ldyBTLkV4cG9ydEZyb20oe1xuICAgICAgbW9kdWxlU3BlY2lmaWVyOlxuICAgICAgICBzLm1vZHVsZVNwZWNpZmllciAhPSBudWxsID8gcy5tb2R1bGVTcGVjaWZpZXIudmFsKCkgOiBudWxsLFxuICAgICAgbmFtZWRFeHBvcnRzOiBzLm5hbWVkRXhwb3J0cy50b0FycmF5KCksXG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==